<!DOCTYPE html>
<html>
<body>

  <h1>IoT Endpoint Server</h1>
  <label for="scale">Temperature Scale:</label>
  <select id="scale">
    <option value="F" selected>Fahrenheit</option>
    <option value="C">Celsius</option>
  </select>
  <div id="msg" class="mt">Awaiting IoT Device Report ...</div>
</body>
</html>

<script>
  // create websocket connection with IoT device.
  const socket = new WebSocket('ws://192.168.1.19:3000'); //iot device
  socket.addEventListener("open", () => {
      document.getElementById("scale").addEventListener("change", () => {
      //send command to the IoT device to change temperature scale
      const command = {"cmd": "scale", "scale": document.getElementById("scale").value, "ts": Date.now()}
      socket.send(JSON.stringify(command))
    })
  })

  //get data to refresh dashboard
  setInterval( () => {
    getDashboardData()
  }, 1000)

  const getDashboardData = async () => {
    try {
      const response = await fetch('http://localhost:3000/dashboard')
      if(!response.ok){
        throw new Error(`Response status: ${response.status}`)
      }
      const json = await response.json()
      if(json !== null){
        document.getElementById("msg").innerHTML = ("IoT Device Reports: " + json)
      }
    } catch(error) {
      console.log(error)
    }
  }

</script>

<style>
  .mt {
    margin-top: 1rem;
  }  
</style>